## Step 0.1.07 — Create `packages/shared` + wire into Web + API (exact)

Goal: **one shared Types package** used by both `apps/web` and `apps/api` from day 1.

---

# 0.1.07a) Create shared package files

Create folder + src:

```bash
mkdir -p packages/shared/src
```

### `packages/shared/package.json`

```json
{
  "name": "@db-gui/shared",
  "private": true,
  "type": "module",
  "version": "0.0.0",
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    }
  },
  "scripts": {
    "dev": "tsc -w -p tsconfig.json",
    "build": "tsc -p tsconfig.json",
    "typecheck": "tsc -p tsconfig.json --noEmit",
    "lint": "echo \"(lint later)\"",
    "format": "prettier -w ."
  },
  "devDependencies": {
    "typescript": "^5.6.3",
    "prettier": "^3.3.3"
  }
}
```

### `packages/shared/tsconfig.json`

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ES2022",
    "moduleResolution": "Bundler",
    "declaration": true,
    "emitDeclarationOnly": false,
    "outDir": "dist",
    "rootDir": "src",
    "strict": true,
    "skipLibCheck": true
  },
  "include": ["src"]
}
```

### `packages/shared/src/index.ts`

```ts
// Core enums used across Dashboard, Checklist, and ERD bindings

export type Dialect = "postgres" | "mysql" | "sqlserver" | "sqlite";

export type Severity = "info" | "warning" | "error" | "blocking";

export type NodeType = "group" | "item";
export type ItemType = "manual" | "automatic" | "hybrid";

export type ScopeType =
  | "diagram"
  | "schema"
  | "table"
  | "column"
  | "relationship"
  | "migration_step";

export type ResultStatus = "unchecked" | "pass" | "warning" | "fail" | "blocked";
export type InstanceStatus = "incomplete" | "pass" | "warning" | "fail" | "blocked";

// ERD binding targets
export type TargetRef =
  | { kind: "diagram" }
  | { kind: "table"; schema: string; table: string }
  | { kind: "column"; schema: string; table: string; column: string }
  | {
      kind: "relationship";
      fkName?: string;
      childSchema: string;
      childTable: string;
      childCols: string[];
      parentSchema: string;
      parentTable: string;
      parentCols: string[];
    };

// “Issues Work Queue” item shape
export interface IssueRow {
  resultId: string;
  severity: Severity;
  status: ResultStatus;
  code: string;
  title: string;
  sectionPath: string[];
  targetRef: TargetRef;
  deepLink?: any;
  suggestedFix?: {
    label: string;
    actionId: string;
    payload?: Record<string, unknown>;
  };
}
```

Install deps:

```bash
pnpm install
pnpm --filter @db-gui/shared build
```

---

# 0.1.07b) Wire shared into `apps/api`

### Add dependency

From repo root:

```bash
pnpm --filter api add @db-gui/shared@workspace:*
```

### Use a shared type in API

Edit `apps/api/src/index.ts`:

```ts
import Fastify from "fastify";
import type { Severity } from "@db-gui/shared";

const app = Fastify({ logger: true });

app.get("/health", async () => {
  const sev: Severity = "info";
  return { ok: true, sev };
});

const port = Number(process.env.PORT ?? 3001);
const host = process.env.HOST ?? "0.0.0.0";

await app.listen({ port, host });
```

Run:

```bash
pnpm --filter api dev
```

---

# 0.1.07c) Wire shared into `apps/web`

### Add dependency

```bash
pnpm --filter web add @db-gui/shared@workspace:*
```

### Use shared type in web UI

Edit `apps/web/src/App.tsx`:

```tsx
import "./App.css";
import type { Severity } from "@db-gui/shared";

export default function App() {
  const sev: Severity = "warning";

  return (
    <div style={{ padding: 24 }}>
      <h1>DB GUI</h1>
      <p>Shared Severity type works: {sev}</p>
    </div>
  );
}
```

Run:

```bash
pnpm --filter web dev
```

---

# 0.1.07d) Root dev experience (optional improvement)

Right now `pnpm dev` runs `tsc -w` in shared and also web/api dev, which is okay.

If you prefer not to watch `shared` separately, you can:

* keep `shared` compiled on demand (`build`) and rely on workspace linking
* or keep `dev` as is and let it run watchers

For now, **leave it**.

---

# Done criteria for 0.1.07

✅ `@db-gui/shared` builds
✅ API imports it and runs
✅ Web imports it and runs

---