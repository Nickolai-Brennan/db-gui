## Checklist Builder UI Spec v1 (Sections → Subsections → Items, infinite depth)

This is the **actual builder** to create and manage your checklist templates + instances, with a modern, clean UX.

---

# 1) Where it lives in the app

Add a top-level area:

**Settings → Checklists** (or **Dashboard → Checklists**)

Tabs:

* **Templates** (design checklists)
* **Instances** (run/track per DB/diagram/migration)
* **Library** (built-in templates: ERD Health, Migration Safety, Data Entry)

---

# 2) Primary Layout (3-pane, modern)

### Left Pane — Tree

* Hierarchical tree with infinite depth
* Node types:

  * Folder/Group (Section/Subsection/Sub-subsection…)
  * Item (atomic check)

**Row shows**

* expand/collapse caret
* title
* status summary (for instances) or type badge (for templates)
* drag handle

Actions:

* `+` add node (section/item)
* right-click: rename, duplicate, delete, move

### Center Pane — Editor

Context-sensitive editor for the selected node:

* If Section/Group: title, description, ordering rules
* If Item: full item configuration (see below)

### Right Pane — Preview / Validation

* Template preview in “instance view”
* Validate SQL templates (if automatic)
* Show “target mapping” preview (table/relationship/diagram)

---

# 3) Node Types & Fields (what the editor supports)

## 3.1 Group Node (Section/Subsection/etc.)

Fields:

* **Title**
* **Description**
* **Icon** (optional)
* **Aggregation rule** (default: bubble-up severity)
* **Visibility rules**:

  * show always
  * show only if contains issues
  * show only if relevant to scope

Controls:

* Move up/down
* Add child group
* Add child item

## 3.2 Item Node (Atomic Check)

Fields:

* **Title** (imperative)
* **Description** (why)
* **Type**

  * Manual
  * Automatic
  * Hybrid
* **Severity**

  * Info / Warning / Error / Blocking
* **Blocks action**

  * toggle (e.g., blocks “Apply Migration”)
* **Scope**

  * Diagram / Schema / Table / Relationship / Column / MigrationStep
* **Target binding**

  * *how to locate the object this item applies to*
  * examples:

    * all tables
    * one table
    * each relationship
    * each FK edge
* **Run policy**

  * on refresh
  * on apply attempt
  * scheduled (later)
* **Evidence required**

  * optional checkbox (requires user note/file)
* **Fix action**

  * none / manual guidance / auto-fix
  * auto-fix needs SQL generation (with preview)

---

# 4) Automatic Checks UX (Postgres v1)

When item type = **Automatic**, show:

### A) Check Definition Mode (choose one)

1. **Built-in check**

   * Dropdown: FK not indexed, missing PK, FK violations, etc.
   * Parameters: schemas, table tags, thresholds
2. **SQL template**

   * SQL editor with `:schemas` variables
   * “Test query” button
   * Expected output schema definition:

     * must return columns like:

       * `schema`, `table` (and optional `column`, `fk_name`)
       * `message` (optional)
   * Mapping panel: map result columns → target binding

### B) Result mapping (required)

A small “Mapper” UI:

* If query returns `schema + table` → target table node
* If returns `child_schema + child_table + fk_name` → target edge
* If returns nothing → PASS

### C) Threshold / severity rules

Example:

* If rows returned > 0 → FAIL
* Or if `violating_rows > 0` → BLOCKING
* Or if `count > threshold` → WARNING

---

# 5) Hybrid Checks UX

Hybrid means:

* auto check runs
* user must confirm “approved” with a note

Example:

* “Cascade deletes are acceptable here”
* Auto flags ON DELETE CASCADE
* User must explicitly approve + add rationale

---

# 6) Template Versioning (must-have)

### Template header

* Template name
* Version: `v1.0`
* “Publish version” button

Rules:

* Published versions are immutable
* Editing creates a draft (v1.1-draft)
* Instances reference a specific version for auditability

---

# 7) Instances (running checklists)

Instances are created automatically when:

* A diagram is created
* A migration plan is generated
* A connection is added

Instance view shows:

* progress bar
* failing items list
* evidence panel

### Instance controls

* Run all checks
* Run selected checks
* Export report (PDF later, JSON now)
* “Override” (if policy allows)

---

# 8) Modern UX details (feel premium)

### Drag and drop

* Drag nodes to reorder
* Drag into/out of groups
* Drop indicator line

### Inline creation

* `Enter` creates sibling
* `Tab` indents (makes child)
* `Shift+Tab` outdents

### Quick add

* `/` command palette:

  * “Add blocking item”
  * “Add FK check”
  * “Add manual review step”

### Search

* Search across template tree (Cmd/Ctrl+F)

---

# 9) Permissions / Safety (v1 simple)

* Templates editable by “Admin” role
* Instances readable by all, override only by admin

(You can add RBAC later.)

---

# 10) Minimal Data Model (DB storage)

Tables (app DB):

* `checklist_templates`
* `checklist_template_versions`
* `checklist_nodes`
* `checklist_instances`
* `checklist_instance_results`
* `checklist_evidence`

If you want, I’ll write the SQL schema for these tables next.

---

## Next options (pick one)

1. **App DB schema** (Postgres tables for templates/instances/results)
2. **Exact JSON schema** (for saving templates + instances)
3. **UI component list** (React components + state model)

Reply with **1**, **2**, or **3**.
