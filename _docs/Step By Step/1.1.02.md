## Step 1.1.02 — Seed Built-in Checklist Templates (ERD Health, Migration Safety, Data Entry) (exact)

Goal: ship with **zero empty states**.

When a user connects a DB and opens Dashboard, they instantly get:
- a real checklist instance
- real issues surfaced
- deep links into ERD / inspector
- fix actions when available

This step creates:
1) **Templates** (ERD Health, Migration Safety, Data Entry Readiness)
2) **Published versions** (v1.0)
3) **Node trees** (sections + items)
4) Optional: demo workspace seed

Templates are based on your Default Checklist Templates v1. fileciteturn0file1

---

# 1.1.02a) Create a seed file layout

Create:

- `apps/api/seed/checklists/erd-health.v1.0.json`
- `apps/api/seed/checklists/migration-safety.v1.0.json`
- `apps/api/seed/checklists/data-entry-readiness.v1.0.json`

Each file is a **TemplateVersion payload**, used by a seed script.

---

# 1.1.02b) JSON shape (authoritative)

Use this shape (minimal v1):

```ts
type SeedTemplate = {
  template: { slug: string; name: string; description?: string };
  version: { version: "v1.0"; isPublished: true };
  nodes: SeedNode[];
};

type SeedNode =
  | {
      nodeType: "group";
      title: string;
      description?: string;
      children: SeedNode[];
    }
  | {
      nodeType: "item";
      title: string;
      description?: string;
      itemType: "manual" | "automatic" | "hybrid";
      severity: "info" | "warning" | "error" | "blocking";
      blocksAction?: boolean;
      scopeType: "diagram" | "schema" | "table" | "column" | "relationship" | "migration_step";

      checkId?: string;          // builtin registry ID or "SQL_TEMPLATE"
      sqlTemplate?: string;      // only if SQL template mode
      resultMapping?: any;       // maps returned columns -> TargetRef
      fixAction?: any;           // suggestedFix
      runPolicy?: any;
    };
```

---

# 1.1.02c) Built-in check IDs (v1 minimum)

These must exist in your backend check registry:

- `NO_PRIMARY_KEY`
- `FK_NOT_INDEXED`
- `FK_HAS_VIOLATIONS`
- `FK_BROKEN`
- `FK_REFERENCES_NON_UNIQUE_PARENT`
- `RISKY_CASCADE`

(Exactly the v1 binding set from your ERD Binding Rules doc.) fileciteturn0file0

---

# 1.1.02d) Example seed JSON (ERD Health v1.0)

Create `apps/api/seed/checklists/erd-health.v1.0.json`:

```json
{
  "template": {
    "slug": "erd-health",
    "name": "ERD Health (Core Integrity)",
    "description": "PK/FK integrity + performance warnings bound to ERD nodes/edges."
  },
  "version": { "version": "v1.0", "isPublished": true },
  "nodes": [
    {
      "nodeType": "group",
      "title": "Tables",
      "children": [
        {
          "nodeType": "group",
          "title": "Primary Keys",
          "children": [
            {
              "nodeType": "item",
              "title": "All tables have a primary key",
              "itemType": "automatic",
              "severity": "blocking",
              "blocksAction": true,
              "scopeType": "table",
              "checkId": "NO_PRIMARY_KEY",
              "runPolicy": { "onRefresh": true }
            }
          ]
        }
      ]
    },
    {
      "nodeType": "group",
      "title": "Relationships",
      "children": [
        {
          "nodeType": "group",
          "title": "Performance",
          "children": [
            {
              "nodeType": "item",
              "title": "All FK columns are indexed (child side)",
              "itemType": "automatic",
              "severity": "warning",
              "scopeType": "relationship",
              "checkId": "FK_NOT_INDEXED",
              "fixAction": {
                "label": "Create index on FK",
                "actionId": "AUTO_CREATE_INDEX"
              },
              "runPolicy": { "onRefresh": true }
            }
          ]
        },
        {
          "nodeType": "group",
          "title": "Referential integrity",
          "children": [
            {
              "nodeType": "item",
              "title": "No FK violations",
              "itemType": "automatic",
              "severity": "blocking",
              "blocksAction": true,
              "scopeType": "relationship",
              "checkId": "FK_HAS_VIOLATIONS",
              "fixAction": {
                "label": "Open violating rows",
                "actionId": "OPEN_VIOLATIONS"
              },
              "runPolicy": { "onRefresh": true, "onApplyAttempt": true }
            }
          ]
        }
      ]
    }
  ]
}
```

---

# 1.1.02e) Seed script (exact behavior)

Write a seed script that:

1) Ensures a workspace exists
2) Inserts templates (by slug)
3) Inserts version `v1.0` as published
4) Inserts nodes recursively, setting:
   - `parent_id`
   - `sort_order`
5) Prevents duplication (idempotent seed)

Pseudo-flow:

```ts
for each seed file:
  upsert template by (workspace_id, slug)
  upsert version by (template_id, version)
  if version is published: set is_published=true
  delete existing nodes for that version (optional) then reinsert tree
```

---

# 1.1.02f) Validation: build-time sanity checks

Before you ship, validate:

- every `checkId` exists in the registry
- every item has `scopeType` set
- blocking items have `blocksAction = true` where intended
- template version is published and immutable

---

# Done criteria for 1.1.02

✅ 3 built-in templates seed cleanly  
✅ Templates create published v1.0 versions  
✅ Node trees render in Builder UI  
✅ Creating an Instance produces a runnable checklist immediately  
✅ No empty dashboard state after adding a connection

---
